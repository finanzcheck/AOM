---
layout: docs
title: Piwik AOM Plugin Documentation
---

<h2 class="title text-center">Piwik AOM Plugin Documentation</h2>
<p>Integrate additional data like campaign names, ad impressions, costs etc. from advertising platforms (such as
    Google AdWords, Microsoft Bing, Criteo, Facebook Ads and Taboola) and individual campaigns (such as cost per
    view/click/acquisition and fixed price per months deals) into Piwik and combine that data with individual visits -
    <strong>create a whole bunch of new opportunities!</strong></p>

<!-- Advertiser's platforms -->
<h2 class="sub-title text-center">Importing and merging advertiser's platforms' data</h2>
<p>To obtain data (campaign names, costs, ad impressions, etc.) from the advertising platforms, API access must be
    granted and configured within the settings of this plugin.</p>

<p>To map individual visits with the data from the advertising platforms, all links from the platforms must have
    <a href="advertisers-platforms.html">additional params</a> that supply mapping-related data like campaign and ad IDs
    to the Piwik AOM plugin. This data is stored in the database columns <code>log_visit.aom_platform</code> and
    <code>log_visit.aom_ad_params</code>. When a visitor returns with other tracking params, a new visit is started
    automatically.</p>

<p>After you have set up a cronjob <code>./console aom:process</code> that gets executed every minute a copy of every
    single Piwik visit is written (and conversions are added) to <code>aom_visits</code>.</p>

<p>After you have set up <a href="http://piwik.org/docs/setup-auto-archiving/">auto archiving</a> the following two
    tasks will be executed by AOM:</p>

<h4 class="sub-title">1. Import data from advertising platforms</h4>
<p>Imported data is stored in the database table <code>aom_{platformName}</code>. Every advertising platform's data is
    aggregated on a daily basis in the timezone of the advertising platform's account. Merged data will only be correct,
    when your website's timezone matches the timezones of each advertising platform account.</p>

<h4 class="sub-title">2. Merge imported data with individual visits</h4>
<p>The background job iterates over all imported advertising platform data and updates the visits in the
    <code>aom_visits</code> table with that data. If no real Piwik visits match the advertising platform's data, an
    artificial visit is being created in the <code>aom_visits</code> table to make sure that all cost is allocated.</p>

<p>The data in <code>aom_visits</code> contains both all Piwik visits and all costs. It is used in the marketing
    performance report in the Piwik UI and it can be used via the <a href="api.html">API endpoints provided by the Piwik
    AOM plugin</a> (e.g. for further processing in a data warehouse).</p>

<p>Whenever a visit is added to or updated in the <code>aom_visits</code> table, an
    <code>AOM.aomVisitAddedOrUpdated</code> event is posted. You can listen to that event within your separate plugin
    to integrate Piwik AOM in your <strong>event oriented architecture</strong> (e.g. to publish those events to
    external systems or message brokers).</p>


<h3 class="sub-title text-center">Manual importing, merging & visit reprocessing</h3>
<p>You can (re)import data manually by executing <code>./console aom:import --platform={platformName}
    --startDate=YYYY-MM-DD --endDate=YYYY-MM-DD</code>. Reimporting data deletes all previously imported data for the
    given platform and period, but it does not delete any data in <code>aom_visits</code> (it only adds and updates to
    that table). Adding <code>--merge=true</code> merges the newly imported data immediately after the import has
    finished.</p>

<p>You can merge imported data manually by executing <code>./console aom:merge --platform={platformName}
    --startDate=YYYY-MM-DD --endDate=YYYY-MM-DD</code>.


<!-- Requirements, installation & updates -->
<h2 class="sub-title text-center">Requirements, installation &amp; updates</h2>

<p>MySQL 5.0.3 or higher is required as we store more than 255 characters in VARCHAR. As we use MySQL multi row inserts
    and updates for a better performance make sure that your
    <a href="https://dev.mysql.com/doc/refman/5.7/en/packet-too-large.html"><code>max_allowed_packet</code> size is high
    enough (this roughly depends on how much visits you have).</p>

<p>You must be able to run cron jobs to set up both
    <a href="http://piwik.org/docs/setup-auto-archiving/">auto archiving</a> and the background job <code>./console
    aom:process</code> (execution of the latter every minute) that updates visits and conversions in the
    <code>aom_visits</code> table.</p>

<p>You can install the Piwik AOM plugin from the <a href="https://plugins.piwik.org/AdvancedOnlineMarketing">Piwik
    marketplace</a>.</p>

<p>Set up <a href="http://piwik.org/docs/setup-auto-archiving/">auto archiving</a> to automatically import and merge
    data from the advertiser's platforms. The auto archiving cron job executes the <code>core:archive command</code>
    which triggers <a href="https://developer.piwik.org/api-reference/Piwik/TaskScheduler">Piwik's TaskScheduler</a> and
    thus this plugin's tasks (see <code>Tasks.php</code>). You can trigger all of this plugin's background jobs manually
    by executing <code>./console core:run-scheduled-tasks --force</code>.</p>

<p>Merging will only be correct, when your website's timezone matches the timezones of each advertising platform
    account.</p>

<p>Add the params that are required to assign imported data to individual visits to all links managed in the advertising
    platforms as described <a href="advertisers-platforms.html">here</a>.</p>


<!-- Limitations -->
<h2 class="sub-title text-center">Limitations</h2>

<h3>Advertising platforms</h3>
<p>All data is being processed on a daily basis, i.e. variations of click costs during the day are not being
    considered.</p>

<h4>Google AdWords</h4>
<p>Visits of Google display network are assigned on AdGroup level.</p>

<h3>Performance</h3>
<p>This plugin has successfully been tested with up to 25k visitors a day for a period of more than two years, running
    on an AWS server with 4 GB RAM and a separate AWS RDS MySQL database. Single PHP processes might use up to 1 GB RAM
    and run for minutes. You might encounter performance issues during importing, merging, accessing the plugin's
    marketing performance report in the UI or using the plugin's API when you have more traffic or a an infrastructure
    with less performance.
</p>


<!-- Changelog -->
<h2 class="sub-title text-center">Changelog</h2>
<p><strong>1.0.0</strong> on 11 July 2017 and afterwards</p>
<ul>
    <li>Restructures the entire Piwik AOM plugin core from lots of batch jobs to an event oriented processing
        (and introduces the <code>AOM.aomVisitAddedOrUpdated</code> event for added and updated visits)</li>
    <li>Breaking backwards compatibility: AdWords auto-tagging (gclid) is now the only supported AdWords tracking
        method</li>
    <li>Breaking backwards compatibility: Renamed status API endpoint to getAomVisitsStatus(...)</li>
    <li>Adds foundations for individual campaigns (still in development, cannot be used yet)</li>
    <li>Rewrote various tests</li>
    <li>The implementation of Facebook Ads is deprecated and does not work at the moment</li>
</ul>
<p><strong>0.6.*</strong> on 17 April 2017 and afterwards</p>
<ul>
    <li>Adds support for Taboola</li>
</ul>
<p><strong>0.5.*</strong> on 17 February 2017 and afterwards</p>
<ul>
    <li>Adds support for Piwik 3</li>
</ul>
<p><strong>0.4.*</strong> on 16 November 2016 and afterwards</p>
<ul>
    <li>Adds gclid as alternative AdWords tracking method</li>
    <li>Updates AdWords and Facebook Ads API</li>
    <li>Adds unique keys to avoid duplicates an imported data</li>
    <li>Adds matchtype to AdWords data</li>
</ul>
<p><strong>0.3.*</strong> on 9 June 2016 and afterwards</p>
<ul>
    <li>Adds drill-downs into marketing performance reports (campaigns, ad groups)</li>
    <li>Fixes [prefixed database table names](https://github.com/advanced-online-marketing/AOM/issues/19) and updates
        dependencies (libraries of AdWords and Facebook Ads)</li>
</ul>
<p><strong>0.2.*</strong> on 22 May 2016 and afterwards</p>
<ul>
    <li>Identifies AOM tracking params from referrer URL in addition to action URL</li>
    <li>Integrates Piwik AOM data into Piwik UI</li>
    <li>Fixes various bugs</li>
</ul>


<!-- License -->
<h2 class="sub-title text-center">License</h2>
<p>GPL v3 / fair use</p>


<!-- Support -->
<h2 class="sub-title text-center">Support</h2>
<p>Please report bugs and suggest features at
    <a href="https://github.com/advanced-online-marketing/AOM/issues">github</a>.</p>
<p>Leave comments or questions regarding this documentation below.</p>
<p>If you require intense consulting or like to sponsor the development of a specific features, get in touch!</p>
